<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Driving Exam Practice</title>
  <style>
    body{font-family:Arial;margin:0;background:#0f172a;color:#fff}
    .container{max-width:900px;margin:auto;padding:20px}
    .hidden{display:none}
    h1,h2{text-align:center}
    button{padding:10px 16px;border:none;border-radius:6px;background:#2563eb;color:#fff;cursor:pointer}
    button:disabled{background:#555}
    .timer{font-size:18px;text-align:right}
    .answers{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:20px}
    .answer{background:#1e293b;padding:12px;border-radius:8px;cursor:pointer;border:2px solid transparent}
    .answer.correct{border-color:#22c55e;background:#14532d}
    .answer.wrong{border-color:#ef4444;background:#7f1d1d}
    img.question-img{max-width:100%;margin:15px 0;border-radius:10px}
    .result-good{color:#22c55e;font-size:26px}
    .result-bad{color:#ef4444;font-size:26px}
    .error-list li{margin:6px 0}
    .center{text-align:center}
    /* === QUESTION IMAGE NORMALIZATION === */

    .image-wrapper{
      display:none;             /* –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –ù–ï–¢ */
      justify-content:center;
      align-items:center;
      margin:20px 0;
      height:260px;
      background:#020617;
      border-radius:12px;
    }

    .image-wrapper.show{
      display:flex;             /* –ø–æ—è–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ */
    }


    .question-img{
      max-width:100%;
      max-height:100%;
      object-fit:contain;       /* –Ω–µ –∏—Å–∫–∞–∂–∞–µ—Ç –ø—Ä–æ–ø–æ—Ä—Ü–∏–∏ */
    }

    /* === –ê–î–ê–ü–¢–ò–í–ù–´–ï –°–¢–ò–õ–ò –î–õ–Ø –ú–û–ë–ò–õ–¨–ù–´–• === */
    @media (max-width: 768px) {
      .container{
        padding:10px;
      }

      h1{
        font-size:24px;
      }

      h2{
        font-size:20px;
      }

      button{
        padding:12px 20px;
        font-size:16px;
        width:100%;
        max-width:300px;
      }

      .timer{
        font-size:16px;
        text-align:center;
        margin-bottom:10px;
      }

      .answers{
        grid-template-columns:1fr;
        gap:10px;
      }

      .answer{
        padding:15px;
        font-size:16px;
      }

      .result-good, .result-bad{
        font-size:20px;
      }

      /* –ö–∞—Ä—Ç–∏–Ω–∫–∏ –Ω–∞ —Å—Ç–∞—Ä—Ç–æ–≤–æ–º —ç–∫—Ä–∞–Ω–µ */
      #startScreenLeftImageContainer,
      #startScreenRightImageContainer{
        width:150px !important;
        height:150px !important;
      }

      /* –ö–∞—Ä—Ç–∏–Ω–∫–∏ –Ω–∞ —ç–∫—Ä–∞–Ω–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ */
      #resultScreenWinImageContainer img,
      #resultScreenLoseImageContainer img{
        max-width:250px !important;
        max-height:250px !important;
      }

      /* –ü–æ–ª–µ –≤–≤–æ–¥–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ */
      #questionsCount{
        width:80px !important;
        font-size:14px !important;
      }

      /* –ö–Ω–æ–ø–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ç–∞–π–º–µ—Ä–∞ */
      #stopTimerBtn{
        font-size:12px;
        padding:8px 12px;
      }

      /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å —Ç–∞–π–º–µ—Ä–æ–º –∏ –∫–Ω–æ–ø–∫–æ–π */
      #examScreen > div:first-child{
        flex-direction:column;
        gap:10px;
        align-items:stretch;
      }

      #examScreen > div:first-child .timer{
        text-align:center;
      }

      #examScreen > div:first-child #stopTimerBtn{
        width:100%;
        max-width:none;
      }

      /* –ö–Ω–æ–ø–∫–∞ Next */
      #nextBtn{
        display:block !important;
        margin:20px auto 0 auto !important;
        width:100%;
        max-width:300px;
      }

      /* –ë–ª–æ–∫ —Å –æ—à–∏–±–∫–∞–º–∏ */
      #errorList > div{
        padding:10px !important;
        margin-bottom:15px !important;
      }

      /* –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –≤–æ–ø—Ä–æ—Å–∞—Ö */
      .image-wrapper{
        height:200px;
        margin:15px 0;
      }

      /* –ö–Ω–æ–ø–∫–∏ –Ω–∞ —ç–∫—Ä–∞–Ω–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ */
      #resultScreen .center{
        display:flex;
        flex-direction:column;
        align-items:center;
        gap:15px;
      }

      #retryBtn,
      #restartFromResultBtn,
      #restartFromTimeOverBtn{
        margin-left:0 !important;
        width:100%;
        max-width:300px;
      }

      /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –∫–Ω–æ–ø–∫–æ–π –Ω–∞ —ç–∫—Ä–∞–Ω–µ Time over */
      #timeOverScreen .center{
        display:flex;
        flex-direction:column;
        align-items:center;
      }
    }

    @media (max-width: 480px) {
      h1{
        font-size:20px;
      }

      h2{
        font-size:18px;
      }

      button{
        padding:10px 16px;
        font-size:14px;
      }

      .answer{
        padding:12px;
        font-size:14px;
      }

      /* –ö–∞—Ä—Ç–∏–Ω–∫–∏ –Ω–∞ —Å—Ç–∞—Ä—Ç–æ–≤–æ–º —ç–∫—Ä–∞–Ω–µ - –µ—â–µ –º–µ–Ω—å—à–µ */
      #startScreenLeftImageContainer,
      #startScreenRightImageContainer{
        width:100px !important;
        height:100px !important;
      }

      /* –ö–∞—Ä—Ç–∏–Ω–∫–∏ –Ω–∞ —ç–∫—Ä–∞–Ω–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ */
      #resultScreenWinImageContainer img,
      #resultScreenLoseImageContainer img{
        max-width:200px !important;
        max-height:200px !important;
      }

      .image-wrapper{
        height:150px;
      }
    }
  </style>
</head>
<body>

  <div class="container">

    <!-- START SCREEN -->
    <div id="startScreen" style="position:relative;min-height:800px">
      <div id="startScreenLeftImageContainer" style="position:fixed;left:-350px;top:70%;transform:translateY(-50%) rotate(20deg);width:900px;height:900px;z-index:1">
        <img id="startScreenLeftImage" src="images/Cats/cat2_main.png" alt="" style="width:100%;height:100%;object-fit:contain">
      </div>
      <div id="startScreenRightImageContainer" style="position:fixed;right:-350px;top:60%;transform:translateY(-50%) rotate(-20deg);width:800px;height:800px;z-index:1">
        <img id="startScreenRightImage" src="images/Cats/cat1_main.png" alt="" style="width:100%;height:100%;object-fit:contain">
      </div>
      <div class="center">
        <h1>Driving Exam Practice</h1>
        <div style="margin:20px 0">
          <label for="questionsCount" style="display:block;margin-bottom:8px">Number of questions:</label>
          <input type="number" id="questionsCount" min="1" max="100" value="50" 
                 style="padding:8px;border-radius:6px;border:2px solid #1e293b;background:#1e293b;color:#fff;width:100px;text-align:center;font-size:16px">
        </div>
        <button id="startBtn">Start exam</button>
      </div>
    </div>

    <!-- EXAM SCREEN -->
    <div id="examScreen" class="hidden">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
        <div class="timer" id="timer"></div>
        <button id="stopTimerBtn" style="background:#ef4444">‚è∏ –ü–µ—Ä–µ–∫—É—Ä</button>
      </div>
      <h2 id="qCounter"></h2>
      <div id="questionText"></div>
      <div id="imageWrapper" class="image-wrapper hidden">
        <img id="questionImage" class="question-img">
      </div>
      <div id="answers" class="answers"></div>
    </div>

    <!-- TIME OVER -->
    <div id="timeOverScreen" class="hidden center">
      <h1>‚è∞ Time is over</h1>
      <div style="margin-top:30px">
        <button id="restartFromTimeOverBtn">Start again</button>
      </div>
    </div>

    <!-- RESULT -->
    <div id="resultScreen" class="hidden" style="position:relative">
      <h1 style="margin:0;margin-bottom:0">Result</h1>
      <p id="scoreText"></p>
      <div id="finalMessage"></div>
      
      <!-- –ö–∞—Ä—Ç–∏–Ω–∫–∞ –¥–ª—è –ø–æ–±–µ–¥–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∞ -->
      <div id="resultScreenWinImageContainer" class="center" style="margin:5px 0;display:none">
        <img id="resultScreenWinImage" src="images/Cats/cats_both_happy.png" alt="" style="max-width:400px;max-height:400px;object-fit:cover;object-position:center">
      </div>
      <!-- –ö–∞—Ä—Ç–∏–Ω–∫–∞ –¥–ª—è –ø—Ä–æ–∏–≥—Ä—ã—à–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∞ -->
      <div id="resultScreenLoseImageContainer" class="center" style="margin:5px 0;display:none">
        <img id="resultScreenLoseImage" src="images/Cats/cats_both_sad.png" alt="" style="max-width:400px;max-height:400px;object-fit:cover;object-position:center">
      </div>
      <div id="errorList" style="margin-bottom:0"></div>
      <div class="center" style="margin-top:30px">
        <button id="retryBtn" style="display:none">Retry mistakes</button>
        <button id="restartFromResultBtn" style="margin-left:10px">Start again</button>
      </div>
      
    </div>

  </div>

  <script>
    let retryMode = false
    let retryPool = []
    let allQuestions=[]
    let exam=[]
    let current=0
    let correctCount=0
    let wrongAnswers=[]
    let timerInterval
    let timeLeft=60*60
    let answered=false
    let questionsCount = 50  // –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–ø—Ä–æ—Å–æ–≤ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    let timerStopped = false
    document.getElementById('retryBtn').onclick = startRetry
    document.getElementById('restartFromTimeOverBtn').onclick = restartExam
    document.getElementById('restartFromResultBtn').onclick = restartExam
    document.getElementById('stopTimerBtn').onclick = toggleTimer

    
    fetch('questions.json')
      .then(r=>r.json())
      .then(d=>{
        allQuestions=d
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ–ª—è –≤–≤–æ–¥–∞
        const questionsCountInput = document.getElementById('questionsCount')
        if(questionsCountInput){
          questionsCountInput.max = allQuestions.length
          questionsCountInput.value = Math.min(50, allQuestions.length)
        }
      })
    
    const startBtn=document.getElementById('startBtn')
    const startScreen=document.getElementById('startScreen')
    const examScreen=document.getElementById('examScreen')
    const resultScreen=document.getElementById('resultScreen')
    const timeOverScreen=document.getElementById('timeOverScreen')
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∫–∞—Ä—Ç–∏–Ω–æ–∫ –Ω–∞ —Å—Ç–∞—Ä—Ç–æ–≤–æ–º —ç–∫—Ä–∞–Ω–µ
    function setStartScreenImages(leftImageSrc, rightImageSrc){
      const leftImg = document.getElementById('startScreenLeftImage')
      const rightImg = document.getElementById('startScreenRightImage')
      const leftContainer = document.getElementById('startScreenLeftImageContainer')
      const rightContainer = document.getElementById('startScreenRightImageContainer')
      
      if(leftImageSrc && leftImg){
        leftImg.src = leftImageSrc
        leftImg.onload = () => leftContainer.style.display = 'block'
        leftImg.onerror = () => leftContainer.style.display = 'none'
      }
      
      if(rightImageSrc && rightImg){
        rightImg.src = rightImageSrc
        rightImg.onload = () => rightContainer.style.display = 'block'
        rightImg.onerror = () => rightContainer.style.display = 'none'
      }
    }
    
    // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—É—Ç–∏ –∫ –∫–∞—Ä—Ç–∏–Ω–∫–∞–º –∑–¥–µ—Å—å (–∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à–∏ –ø—É—Ç–∏)
    // setStartScreenImages('images/left.png', 'images/right.png')
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ä—Ç–∏–Ω–æ–∫, —É–∫–∞–∑–∞–Ω–Ω—ã—Ö –≤ HTML
    const leftImg = document.getElementById('startScreenLeftImage')
    const rightImg = document.getElementById('startScreenRightImage')
    const leftContainer = document.getElementById('startScreenLeftImageContainer')
    const rightContainer = document.getElementById('startScreenRightImageContainer')
    
    if(leftImg && leftImg.src){
      leftImg.onload = () => {
        if(leftContainer) leftContainer.style.display = 'block'
      }
      leftImg.onerror = () => {
        if(leftContainer) leftContainer.style.display = 'none'
        console.error('Failed to load left image:', leftImg.src)
      }
    }
    
    if(rightImg && rightImg.src){
      rightImg.onload = () => {
        if(rightContainer) rightContainer.style.display = 'block'
      }
      rightImg.onerror = () => {
        if(rightContainer) rightContainer.style.display = 'none'
        console.error('Failed to load right image:', rightImg.src)
      }
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∫–∞—Ä—Ç–∏–Ω–æ–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    function setResultScreenImages(winImageSrc, loseImageSrc){
      const winImg = document.getElementById('resultScreenWinImage')
      const loseImg = document.getElementById('resultScreenLoseImage')
      const winContainer = document.getElementById('resultScreenWinImageContainer')
      const loseContainer = document.getElementById('resultScreenLoseImageContainer')
      
      if(winImageSrc && winImg){
        winImg.src = winImageSrc
        winImg.onload = () => {
          // –ö–∞—Ä—Ç–∏–Ω–∫–∞ –±—É–¥–µ—Ç –ø–æ–∫–∞–∑–∞–Ω–∞ –≤ finishExam –ø—Ä–∏ –ø–æ–±–µ–¥–µ
        }
        winImg.onerror = () => {
          if(winContainer) winContainer.style.display = 'none'
          console.error('Failed to load win image:', winImg.src)
        }
      }
      
      if(loseImageSrc && loseImg){
        loseImg.src = loseImageSrc
        loseImg.onload = () => {
          // –ö–∞—Ä—Ç–∏–Ω–∫–∞ –±—É–¥–µ—Ç –ø–æ–∫–∞–∑–∞–Ω–∞ –≤ finishExam –ø—Ä–∏ –ø—Ä–æ–∏–≥—Ä—ã—à–µ
        }
        loseImg.onerror = () => {
          if(loseContainer) loseContainer.style.display = 'none'
          console.error('Failed to load lose image:', loseImg.src)
        }
      }
    }
    
    // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—É—Ç–∏ –∫ –∫–∞—Ä—Ç–∏–Ω–∫–∞–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∑–¥–µ—Å—å
    // setResultScreenImages('images/win.png', 'images/lose.png')
    
    startBtn.onclick=startExam
    

    function startExam(){

      retryMode = false
      retryPool = []
      document.getElementById('retryBtn').style.display = 'none'

      // –ü–æ–ª—É—á–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–ø—Ä–æ—Å–æ–≤ –∏–∑ –ø–æ–ª—è –≤–≤–æ–¥–∞
      questionsCount = parseInt(document.getElementById('questionsCount').value) || 50
      if(questionsCount < 1) questionsCount = 1
      if(questionsCount > allQuestions.length) questionsCount = allQuestions.length

      startScreen.classList.add('hidden')
      examScreen.classList.remove('hidden')
    
      exam=[...allQuestions].sort(()=>Math.random()-0.5).slice(0,questionsCount)
      current=0
      correctCount=0
      wrongAnswers=[]
      timeLeft=3600
    
      startTimer()
      renderQuestion()
    }
    
    function startTimer(){
      timerStopped = false
      updateTimer()
      const stopBtn = document.getElementById('stopTimerBtn')
      stopBtn.textContent = '‚è∏ –ü–µ—Ä–µ–∫—É—Ä'
      stopBtn.style.background = '#ef4444'
      // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Ç–∞–π–º–µ—Ä–∞
      updateAnswerButtonsState()
      timerInterval=setInterval(()=>{
        if(!timerStopped){
          timeLeft--
          updateTimer()
          if(timeLeft<=0){
            clearInterval(timerInterval)
            endByTime()
          }
        }
      },1000)
    }

    function toggleTimer(){
      timerStopped = !timerStopped
      const stopBtn = document.getElementById('stopTimerBtn')
      if(timerStopped){
        stopBtn.textContent = '‚ñ∂ –í–µ—Ä–Ω—É–ª–∞—Å—å'
        stopBtn.style.background = '#22c55e'
      }else{
        stopBtn.textContent = '‚è∏ –ü–µ—Ä–µ–∫—É—Ä'
        stopBtn.style.background = '#ef4444'
      }
      // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ –æ—Ç–≤–µ—Ç–æ–≤
      updateAnswerButtonsState()
    }

    function updateAnswerButtonsState(){
      const allAnswers = document.querySelectorAll('.answer')
      allAnswers.forEach(answer => {
        if(timerStopped){
          // –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫–∏
          answer.style.pointerEvents = 'none'
          answer.style.opacity = '0.5'
          answer.style.cursor = 'not-allowed'
        }else{
          // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫–∏
          answer.style.pointerEvents = 'auto'
          answer.style.opacity = '1'
          answer.style.cursor = 'pointer'
        }
      })
    }
    
    function updateTimer(){
      const m=Math.floor(timeLeft/60)
      const s=timeLeft%60
      document.getElementById('timer').textContent=`‚è± ${m}:${s.toString().padStart(2,'0')}`
    }
    
    function cleanOptions(q){
      let raw=[...q.options]

      // 1. —É–±–∏—Ä–∞–µ–º —Å—Ç—Ä–æ–∫—É-–≤–æ–ø—Ä–æ—Å
      raw = raw.filter(o => o.trim() !== q.question.trim())

      let result = []
      let current = ''

      raw.forEach(line=>{
        line = line.trim()
        if(!line) return

        // –µ—Å–ª–∏ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å ‚Ä¢ ‚Äî —ç—Ç–æ –Ω–æ–≤—ã–π –≤–∞—Ä–∏–∞–Ω—Ç
        if(line.startsWith('‚Ä¢')){
          if(current) result.push(current.trim())
          current = line
        }else{
          // –∏–Ω–∞—á–µ —ç—Ç–æ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞
          if(current){
            current += ' ' + line
          }
        }
      })

      if(current) result.push(current.trim())

      // –µ—Å–ª–∏ –≤–¥—Ä—É–≥ –±–æ–ª—å—à–µ 4 ‚Äî –±–µ—Ä—ë–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ 4
      if(result.length > 4){
        result = result.slice(-4)
      }

      return result
    }

    
    function renderQuestion(){
      answered=false
      const q=exam[current]
      
      let opts

      if(q.type === 'type_3'){
        // –æ—Ç–≤–µ—Ç—ã ‚Äî –∫–∞—Ä—Ç–∏–Ω–∫–∏ (–æ–ø—Ü–∏–∏ —É–∂–µ —è–≤–ª—è—é—Ç—Å—è –ø—É—Ç—è–º–∏ –∫ –∫–∞—Ä—Ç–∏–Ω–∫–∞–º)
        opts = Array.isArray(q.options) ? q.options.filter(o => o && typeof o === 'string' && o.trim()) : []
        if(opts.length > 4){
          opts = opts.slice(0, 4)
        }
      }else{
        // –æ—Ç–≤–µ—Ç—ã ‚Äî —Ç–µ–∫—Å—Ç
        opts = cleanOptions(q)
      }

    
      document.getElementById('qCounter').textContent=`Question ${current+1} / ${questionsCount}`
      document.getElementById('questionText').textContent=q.question
    
      // ID –≤ —É–≥–ª—É
      renderQuestionId(q.id)
    
      const qImg = document.getElementById('questionImage')
      const wrapper = document.getElementById('imageWrapper')

      // —Å–±—Ä–æ—Å
      qImg.src = ''
      wrapper.classList.remove('show')

      // –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –¢–û–õ–¨–ö–û –µ—Å–ª–∏ –µ—Å—Ç—å –∫–∞—Ä—Ç–∏–Ω–∫–∞ –∏ —ç—Ç–æ type_2
      if(q.image && q.type === 'type_2'){
        qImg.src = q.image
        wrapper.classList.add('show')
      }

    
    
      const answersDiv=document.getElementById('answers')
      answersDiv.innerHTML=''
    
      opts.forEach(opt=>{
        const div = document.createElement('div')
        div.className = 'answer'

        // --- TYPE 3 : –æ—Ç–≤–µ—Ç—ã-–∫–∞—Ä—Ç–∏–Ω–∫–∏ ---
        if(q.type === 'type_3'){
          const img = document.createElement('img')
          img.src = opt
          img.style.maxWidth = '100%'
          img.style.maxHeight = '140px'
          img.style.objectFit = 'contain'
          div.appendChild(img)

          div.dataset.value = opt   // –≤–∞–∂–Ω–æ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
        }
        // --- TYPE 1 / 2 : —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –æ—Ç–≤–µ—Ç—ã ---
        else{
          div.textContent = opt
          div.dataset.value = opt
        }

        div.onclick = () => {
          if(!timerStopped){
            selectAnswer(div, q)
          }
        }
        answersDiv.appendChild(div)
      })

      // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∞–π–º–µ—Ä–∞
      updateAnswerButtonsState()
    
      renderNextButton(false)
    }
    
    function selectAnswer(div, q){
      if(answered) return
      if(timerStopped) return  // –ù–µ –ø–æ–∑–≤–æ–ª—è–µ–º –æ—Ç–≤–µ—á–∞—Ç—å, –µ—Å–ª–∏ —Ç–∞–π–º–µ—Ä –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
      answered = true

      const all = document.querySelectorAll('.answer')
      all.forEach(a => a.onclick = null)

      const correct = q.answer

      all.forEach(a=>{
        if(a.dataset.value === correct){
          a.classList.add('correct')
        }
      })

      if(div.dataset.value === correct){
        correctCount++
      }else{
        div.classList.add('wrong')
        wrongAnswers.push({
          ...q,
          userAnswer: div.dataset.value   // –∑–∞–ø–æ–º–∏–Ω–∞–µ–º –≤—ã–±–æ—Ä
        })
      }


      renderNextButton(true)
    }

    
    function renderNextButton(show){
      let btn=document.getElementById('nextBtn')
      if(!btn){
        btn=document.createElement('button')
        btn.id='nextBtn'
        btn.textContent='Next'
        btn.style.marginTop='20px'
        btn.onclick=nextQuestion
        document.getElementById('answers').after(btn)
      }
      btn.style.display=show?'block':'none'
    }
    
    function nextQuestion(){
      current++
      if(current>=exam.length){
        finishExam()
      }else renderQuestion()
    }
    
    function endByTime(){
      examScreen.classList.add('hidden')
      timeOverScreen.classList.remove('hidden')
    }
    
    function finishExam(){
      clearInterval(timerInterval)
      examScreen.classList.add('hidden')
      resultScreen.classList.remove('hidden')
    
      const percent=(correctCount/questionsCount)*100
      document.getElementById('scoreText').textContent=
        `Correct answers: ${correctCount} / ${questionsCount} (${percent.toFixed(1)}%)`
    
      const msg=document.getElementById('finalMessage')
      const winImageContainer = document.getElementById('resultScreenWinImageContainer')
      const loseImageContainer = document.getElementById('resultScreenLoseImageContainer')
      
      if(percent>=90){
        msg.innerHTML=`<div class="result-good">üéâ Congratulations! You passed!</div>`
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–∞—Ä—Ç–∏–Ω–∫—É –ø–æ–±–µ–¥—ã
        if(winImageContainer) winImageContainer.style.display = 'block'
        if(loseImageContainer) loseImageContainer.style.display = 'none'
      }else{
        msg.innerHTML=`<div class="result-bad">üò¢ Not passed</div>`
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–∞—Ä—Ç–∏–Ω–∫—É –ø—Ä–æ–∏–≥—Ä—ã—à–∞
        if(winImageContainer) winImageContainer.style.display = 'none'
        if(loseImageContainer) loseImageContainer.style.display = 'block'
      }
    
      const list = document.getElementById('errorList')
      list.innerHTML = ''

      wrongAnswers.forEach(q=>{
        const block = document.createElement('div')
        block.style.marginBottom = '30px'
        block.style.padding = '15px'
        block.style.background = '#020617'
        block.style.borderRadius = '10px'

        // --- –í–æ–ø—Ä–æ—Å ---
        const title = document.createElement('div')
        title.innerHTML = `<b>[${q.id}] ${q.question}</b>`
        block.appendChild(title)

        // --- –ö–∞—Ä—Ç–∏–Ω–∫–∞ (–µ—Å–ª–∏ –±—ã–ª–∞) ---
        if(q.image){
          const img = document.createElement('img')
          img.src = q.image
          img.style.maxWidth = '100%'
          img.style.margin = '10px 0'
          img.style.borderRadius = '8px'
          block.appendChild(img)
        }

        // --- –í–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤ ---
        let opts
        if(q.type === 'type_3'){
          // –î–ª—è type_3 –æ–ø—Ü–∏–∏ —É–∂–µ —è–≤–ª—è—é—Ç—Å—è –ø—É—Ç—è–º–∏ –∫ –∫–∞—Ä—Ç–∏–Ω–∫–∞–º
          opts = Array.isArray(q.options) ? q.options : []
          if(opts.length > 4){
            opts = opts.slice(0, 4)
          }
        }else{
          opts = cleanOptions(q)
        }
        const grid = document.createElement('div')
        grid.className = 'answers'

        opts.forEach(opt=>{
          const div = document.createElement('div')
          div.className = 'answer'

          // TYPE 3 ‚Äî –∫–∞—Ä—Ç–∏–Ω–∫–∏
          if(q.type === 'type_3'){
            const img = document.createElement('img')
            img.src = opt
            img.style.maxWidth = '100%'
            img.style.maxHeight = '120px'
            img.style.objectFit = 'contain'
            div.appendChild(img)
            div.dataset.value = opt
          }
          // TYPE 1 / 2 ‚Äî —Ç–µ–∫—Å—Ç
          else{
            div.textContent = opt
            div.dataset.value = opt
          }

          // --- –ø–æ–¥—Å–≤–µ—Ç–∫–∞ ---
          if(div.dataset.value === q.answer){
            div.classList.add('correct')
          }
          if(div.dataset.value === q.userAnswer){
            div.classList.add('wrong')
          }

          grid.appendChild(div)
        })

        block.appendChild(grid)
        list.appendChild(block)
      })
      // --- —Å–æ—Ö—Ä–∞–Ω—è–µ–º –æ—à–∏–±–∫–∏ –¥–ª—è –ø–æ–≤—Ç–æ—Ä–∞ ---
      retryPool = wrongAnswers.map(w => ({
        id: w.id,
        question: w.question,
        options: w.options,
        answer: w.answer,
        image: w.image,
        type: w.type
      }))

      const retryBtn = document.getElementById('retryBtn')
      if(retryPool.length){
        retryBtn.style.display = 'inline-block'
      }else{
        retryBtn.style.display = 'none'
      }


    }
    
    /* ===== ID –í –£–ì–õ–£ ===== */
    function renderQuestionId(id){
      let el=document.getElementById('qid')
      if(!el){
        el=document.createElement('div')
        el.id='qid'
        el.style.position='fixed'
        el.style.bottom='10px'
        el.style.left='10px'
        el.style.opacity='0.6'
        el.style.fontSize='12px'
        document.body.appendChild(el)
      }
      el.textContent=`ID: ${id}`
    }
    function startRetry(){
      if(!retryPool.length) return

      retryMode = true
      exam = [...retryPool]
      current = 0
      correctCount = 0
      wrongAnswers = []
      timeLeft = 60 * 60   // –º–æ–∂–Ω–æ –∏ –º–µ–Ω—å—à–µ, –µ—Å–ª–∏ —Ö–æ—á–µ—à—å

      resultScreen.classList.add('hidden')
      examScreen.classList.remove('hidden')

      startTimer()
      renderQuestion()
    }

    function restartExam(){
      // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∞–π–º–µ—Ä
      if(timerInterval){
        clearInterval(timerInterval)
      }

      // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —ç–∫—Ä–∞–Ω—ã
      examScreen.classList.add('hidden')
      resultScreen.classList.add('hidden')
      timeOverScreen.classList.add('hidden')

      // –°–∫—Ä—ã–≤–∞–µ–º –∫–∞—Ä—Ç–∏–Ω–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
      const winImageContainer = document.getElementById('resultScreenWinImageContainer')
      const loseImageContainer = document.getElementById('resultScreenLoseImageContainer')
      if(winImageContainer) winImageContainer.style.display = 'none'
      if(loseImageContainer) loseImageContainer.style.display = 'none'

      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ä—Ç–æ–≤—ã–π —ç–∫—Ä–∞–Ω
      startScreen.classList.remove('hidden')

      // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
      retryMode = false
      retryPool = []
      exam = []
      current = 0
      correctCount = 0
      wrongAnswers = []
      timeLeft = 60 * 60
      answered = false
      questionsCount = 50
      timerStopped = false

      // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –ø–æ–≤—Ç–æ—Ä–∞
      document.getElementById('retryBtn').style.display = 'none'
    }

  </script>
  
</body>
</html>
